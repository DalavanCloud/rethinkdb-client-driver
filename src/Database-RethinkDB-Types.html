<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Database/RethinkDB/Types.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveGeneric         #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies          #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE FlexibleInstances     #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts      #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE GADTs                 #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE OverloadedStrings     #-}</span>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE MultiParamTypeClasses #-}</span>
<a name="line-8"></a>
<a name="line-9"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>RethinkDB</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span> <span class='hs-keyword'>where</span>
<a name="line-10"></a>
<a name="line-11"></a>
<a name="line-12"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span>
<a name="line-13"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>State</span> <span class='hs-layout'>(</span><span class='hs-conid'>State</span><span class='hs-layout'>,</span> <span class='hs-varid'>gets</span><span class='hs-layout'>,</span> <span class='hs-varid'>modify</span><span class='hs-layout'>,</span> <span class='hs-varid'>evalState</span><span class='hs-layout'>)</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Word</span>
<a name="line-16"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>String</span>
<a name="line-17"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span>           <span class='hs-layout'>(</span><span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-18"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Time</span>
<a name="line-19"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Time</span><span class='hs-varop'>.</span><span class='hs-conid'>Clock</span><span class='hs-varop'>.</span><span class='hs-conid'>POSIX</span>
<a name="line-20"></a>
<a name="line-21"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Aeson</span>          <span class='hs-layout'>(</span><span class='hs-conid'>FromJSON</span><span class='hs-layout'>,</span> <span class='hs-varid'>parseJSON</span><span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span><span class='hs-layout'>)</span>
<a name="line-22"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Aeson</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>    <span class='hs-layout'>(</span><span class='hs-conid'>Parser</span><span class='hs-layout'>,</span> <span class='hs-conid'>Value</span><span class='hs-layout'>)</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Aeson</span>          <span class='hs-keyword'>as</span> <span class='hs-conid'>A</span>
<a name="line-24"></a>
<a name="line-25"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Vector</span>         <span class='hs-layout'>(</span><span class='hs-conid'>Vector</span><span class='hs-layout'>)</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Vector</span>         <span class='hs-keyword'>as</span> <span class='hs-conid'>V</span>
<a name="line-27"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HashMap</span><span class='hs-varop'>.</span><span class='hs-conid'>Strict</span> <span class='hs-layout'>(</span><span class='hs-conid'>HashMap</span><span class='hs-layout'>)</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>HashMap</span><span class='hs-varop'>.</span><span class='hs-conid'>Strict</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>HMS</span>
<a name="line-29"></a>
<a name="line-30"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>RethinkDB</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>Datum</span>
<a name="line-31"></a>
<a name="line-32"></a>
<a name="line-33"></a>
<a name="line-34"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-35"></a><span class='hs-comment'>-- | A Term is a JSON expression which can be sent to the server. Building a</span>
<a name="line-36"></a><span class='hs-comment'>-- term is a stateful operation, so the whole process happens inside a 'State'</span>
<a name="line-37"></a><span class='hs-comment'>-- monad.</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="Term"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Term</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-40"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span> <span class='hs-conid'>Context</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Value</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="instance%20Term%20A.Value"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Value</span> <span class='hs-keyword'>where</span>
<a name="line-43"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span>
<a name="line-44"></a>
<a name="line-45"></a>
<a name="line-46"></a>
<a name="line-47"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-48"></a><span class='hs-comment'>-- | Building a RethinkDB query from an expression is a stateful process, and</span>
<a name="line-49"></a><span class='hs-comment'>-- is done using this as the context.</span>
<a name="line-50"></a>
<a name="line-51"></a><a name="Context"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Context</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Context</span>
<a name="line-52"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>varCounter</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Int</span>
<a name="line-53"></a>      <span class='hs-comment'>-- ^ How many 'Var's have been allocated. See 'newVar'.</span>
<a name="line-54"></a>
<a name="line-55"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>defaultDatabase</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Database</span><span class='hs-layout'>)</span>
<a name="line-56"></a>      <span class='hs-comment'>-- ^ The default database for the case that the 'Table' expression</span>
<a name="line-57"></a>      <span class='hs-comment'>-- doesn't specify one.</span>
<a name="line-58"></a>    <span class='hs-layout'>}</span>
<a name="line-59"></a>
<a name="line-60"></a>
<a name="line-61"></a><a name="compileTerm"></a><span class='hs-definition'>compileTerm</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Database</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span> <span class='hs-conid'>Context</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Value</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Value</span>
<a name="line-62"></a><span class='hs-definition'>compileTerm</span> <span class='hs-varid'>db</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>evalState</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>Context</span> <span class='hs-num'>0</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span>
<a name="line-63"></a>
<a name="line-64"></a>
<a name="line-65"></a><a name="newVar"></a><span class='hs-comment'>-- | Allocate a new var index from the context.</span>
<a name="line-66"></a><span class='hs-definition'>newVar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>State</span> <span class='hs-conid'>Context</span> <span class='hs-conid'>Int</span>
<a name="line-67"></a><span class='hs-definition'>newVar</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-68"></a>    <span class='hs-varid'>ix</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>gets</span> <span class='hs-varid'>varCounter</span>
<a name="line-69"></a>    <span class='hs-varid'>modify</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>s</span> <span class='hs-layout'>{</span> <span class='hs-varid'>varCounter</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ix</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span> <span class='hs-layout'>}</span>
<a name="line-70"></a>    <span class='hs-varid'>pure</span> <span class='hs-varid'>ix</span>
<a name="line-71"></a>
<a name="line-72"></a>
<a name="line-73"></a>
<a name="line-74"></a><a name="IsDatum"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span>
<a name="line-75"></a>
<a name="line-76"></a><a name="instance%20IsDatum%20Datum%20instance%20Term%20Datum"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span> <span class='hs-conid'>Datum</span>
<a name="line-77"></a>
<a name="line-78"></a><a name="instance%20Term%20Datum"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>Datum</span> <span class='hs-keyword'>where</span>
<a name="line-79"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Null</span>    <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Null</span>
<a name="line-80"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bool</span>   <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span>
<a name="line-81"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Number</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span>
<a name="line-82"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span>
<a name="line-83"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span>  <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span>
<a name="line-84"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Object</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span>
<a name="line-85"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Time</span>   <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span>
<a name="line-86"></a>
<a name="line-87"></a><a name="instance%20FromResponse%20Datum"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>Datum</span> <span class='hs-keyword'>where</span>
<a name="line-88"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="instance%20FromResponse%20(Maybe%20Datum)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-91"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseType</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseResult</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-92"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>SuccessAtom</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-93"></a>            <span class='hs-varid'>res0</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parseWire</span> <span class='hs-varid'>a</span>
<a name="line-94"></a>            <span class='hs-keyword'>case</span> <span class='hs-varid'>res0</span> <span class='hs-keyword'>of</span>
<a name="line-95"></a>                <span class='hs-conid'>Null</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>Nothing</span>
<a name="line-96"></a>                <span class='hs-varid'>res</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>res</span>
<a name="line-97"></a>        <span class='hs-keyword'>_</span>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fail</span> <span class='hs-varop'>$</span> <span class='hs-str'>"responseAtomParser: Not a single-element vector "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseResult</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-98"></a>
<a name="line-99"></a>
<a name="line-100"></a>
<a name="line-101"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-102"></a><span class='hs-comment'>-- | For a boolean type, we're reusing the standard Haskell 'Bool' type.</span>
<a name="line-103"></a>
<a name="line-104"></a><a name="instance%20IsDatum%20Bool%20instance%20FromResponse%20Bool"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span> <span class='hs-conid'>Bool</span>
<a name="line-105"></a>
<a name="line-106"></a><a name="instance%20FromResponse%20Bool"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>Bool</span> <span class='hs-keyword'>where</span>
<a name="line-107"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-108"></a>
<a name="line-109"></a><a name="instance%20Term%20Bool"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>Bool</span> <span class='hs-keyword'>where</span>
<a name="line-110"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Bool</span>
<a name="line-111"></a>
<a name="line-112"></a>
<a name="line-113"></a>
<a name="line-114"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-115"></a><span class='hs-comment'>-- | Numbers are 'Double' (unlike 'Aeson', which uses 'Scientific'). No</span>
<a name="line-116"></a><span class='hs-comment'>-- particular reason.</span>
<a name="line-117"></a>
<a name="line-118"></a><a name="instance%20IsDatum%20Double%20instance%20FromResponse%20Double"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span> <span class='hs-conid'>Double</span>
<a name="line-119"></a>
<a name="line-120"></a><a name="instance%20FromResponse%20Double"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>Double</span> <span class='hs-keyword'>where</span>
<a name="line-121"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-122"></a>
<a name="line-123"></a><a name="instance%20Term%20Double"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>Double</span> <span class='hs-keyword'>where</span>
<a name="line-124"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>toJSON</span>
<a name="line-125"></a>
<a name="line-126"></a>
<a name="line-127"></a><a name="instance%20FromResponse%20Int"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>Int</span> <span class='hs-keyword'>where</span>
<a name="line-128"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-129"></a>
<a name="line-130"></a>
<a name="line-131"></a>
<a name="line-132"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-133"></a><span class='hs-comment'>-- | For strings, we're using the Haskell 'Text' type.</span>
<a name="line-134"></a>
<a name="line-135"></a><a name="instance%20IsDatum%20Text%20instance%20FromResponse%20Text"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span> <span class='hs-conid'>Text</span>
<a name="line-136"></a>
<a name="line-137"></a><a name="instance%20FromResponse%20Text"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>Text</span> <span class='hs-keyword'>where</span>
<a name="line-138"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-139"></a>
<a name="line-140"></a><a name="instance%20Term%20Text"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>Text</span> <span class='hs-keyword'>where</span>
<a name="line-141"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>.</span> <span class='hs-varid'>toJSON</span>
<a name="line-142"></a>
<a name="line-143"></a>
<a name="line-144"></a>
<a name="line-145"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-146"></a><span class='hs-comment'>-- | Arrays are vectors of 'Datum'.</span>
<a name="line-147"></a>
<a name="line-148"></a><a name="instance%20IsDatum%20(Array%20a)%20instance%20(IsDatum%20a)%20=%3e%20IsSequence%20(Array%20a)%20instance%20(FromDatum%20a)%20=%3e%20FromResponse%20(Array%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>IsDatum</span>    <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-149"></a><a name="instance%20IsSequence%20(Array%20a)%20instance%20(FromDatum%20a)%20=%3e%20FromResponse%20(Array%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>IsSequence</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-150"></a>
<a name="line-151"></a><a name="instance%20FromResponse%20(Array%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>FromResponse</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-152"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-153"></a>
<a name="line-154"></a><a name="instance%20Term%20(Array%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Term</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Term</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-155"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-156"></a>        <span class='hs-varid'>vals</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-157"></a>        <span class='hs-varid'>options</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>emptyOptions</span>
<a name="line-158"></a>        <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span> <span class='hs-varop'>$</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>$</span>
<a name="line-159"></a>            <span class='hs-keyglyph'>[</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span> <span class='hs-num'>2</span>
<a name="line-160"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span> <span class='hs-varid'>vals</span>
<a name="line-161"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-varid'>options</span>
<a name="line-162"></a>            <span class='hs-keyglyph'>]</span>
<a name="line-163"></a>
<a name="line-164"></a>
<a name="line-165"></a>
<a name="line-166"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-167"></a><span class='hs-comment'>-- | Objects are maps from 'Text' to 'Datum'. Like 'Aeson', we're using</span>
<a name="line-168"></a><span class='hs-comment'>-- 'HashMap'.</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="IsObject"></a><span class='hs-keyword'>class</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>IsObject</span> <span class='hs-varid'>a</span>
<a name="line-171"></a>
<a name="line-172"></a>
<a name="line-173"></a><a name="instance%20IsDatum%20Object%20instance%20IsObject%20Object%20instance%20FromResponse%20Object"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span>  <span class='hs-conid'>Object</span>
<a name="line-174"></a><a name="instance%20IsObject%20Object%20instance%20FromResponse%20Object"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsObject</span> <span class='hs-conid'>Object</span>
<a name="line-175"></a>
<a name="line-176"></a><a name="instance%20FromResponse%20Object"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>Object</span> <span class='hs-keyword'>where</span>
<a name="line-177"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-178"></a>
<a name="line-179"></a><a name="instance%20Term%20Object"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>Object</span> <span class='hs-keyword'>where</span>
<a name="line-180"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-181"></a>        <span class='hs-varid'>items</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>(,)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pure</span> <span class='hs-varid'>k</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-varid'>x</span>
<a name="line-182"></a>        <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Object</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>$</span> <span class='hs-varid'>items</span>
<a name="line-183"></a>
<a name="line-184"></a>
<a name="line-185"></a>
<a name="line-186"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-187"></a><span class='hs-comment'>-- | Time in RethinkDB is represented similar to the 'ZonedTime' type. Except</span>
<a name="line-188"></a><span class='hs-comment'>-- that the JSON representation on the wire looks different from the default</span>
<a name="line-189"></a><span class='hs-comment'>-- used by 'Aeson'. Therefore we have a custom 'FromRSON' and 'ToRSON'</span>
<a name="line-190"></a><span class='hs-comment'>-- instances.</span>
<a name="line-191"></a>
<a name="line-192"></a><a name="instance%20IsDatum%20ZonedTime%20instance%20IsObject%20ZonedTime%20instance%20FromResponse%20ZonedTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span>  <span class='hs-conid'>ZonedTime</span>
<a name="line-193"></a><a name="instance%20IsObject%20ZonedTime%20instance%20FromResponse%20ZonedTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsObject</span> <span class='hs-conid'>ZonedTime</span>
<a name="line-194"></a>
<a name="line-195"></a><a name="instance%20FromResponse%20ZonedTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>ZonedTime</span> <span class='hs-keyword'>where</span>
<a name="line-196"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-197"></a>
<a name="line-198"></a><a name="instance%20Term%20ZonedTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>ZonedTime</span> <span class='hs-keyword'>where</span>
<a name="line-199"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-varid'>object</span>
<a name="line-200"></a>        <span class='hs-keyglyph'>[</span> <span class='hs-str'>"$reql_type$"</span> <span class='hs-conid'>A</span><span class='hs-varop'>..=</span> <span class='hs-layout'>(</span><span class='hs-str'>"TIME"</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-201"></a>        <span class='hs-layout'>,</span> <span class='hs-str'>"timezone"</span>    <span class='hs-conid'>A</span><span class='hs-varop'>..=</span> <span class='hs-layout'>(</span><span class='hs-varid'>timeZoneOffsetString</span> <span class='hs-varop'>$</span> <span class='hs-varid'>zonedTimeZone</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span>
<a name="line-202"></a>        <span class='hs-layout'>,</span> <span class='hs-str'>"epoch_time"</span>  <span class='hs-conid'>A</span><span class='hs-varop'>..=</span> <span class='hs-layout'>(</span><span class='hs-varid'>realToFrac</span> <span class='hs-varop'>$</span> <span class='hs-varid'>utcTimeToPOSIXSeconds</span> <span class='hs-varop'>$</span> <span class='hs-varid'>zonedTimeToUTC</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span>
<a name="line-203"></a>        <span class='hs-keyglyph'>]</span>
<a name="line-204"></a>
<a name="line-205"></a>
<a name="line-206"></a>
<a name="line-207"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-208"></a><span class='hs-comment'>-- UTCTime</span>
<a name="line-209"></a>
<a name="line-210"></a><a name="instance%20IsDatum%20UTCTime%20instance%20IsObject%20UTCTime%20instance%20FromResponse%20UTCTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span>  <span class='hs-conid'>UTCTime</span>
<a name="line-211"></a><a name="instance%20IsObject%20UTCTime%20instance%20FromResponse%20UTCTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsObject</span> <span class='hs-conid'>UTCTime</span>
<a name="line-212"></a>
<a name="line-213"></a><a name="instance%20FromResponse%20UTCTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromResponse</span> <span class='hs-conid'>UTCTime</span> <span class='hs-keyword'>where</span>
<a name="line-214"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseAtomParser</span>
<a name="line-215"></a>
<a name="line-216"></a><a name="instance%20Term%20UTCTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>UTCTime</span> <span class='hs-keyword'>where</span>
<a name="line-217"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varop'>.</span> <span class='hs-varid'>utcToZonedTime</span> <span class='hs-varid'>utc</span>
<a name="line-218"></a>
<a name="line-219"></a>
<a name="line-220"></a>
<a name="line-221"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-222"></a><span class='hs-comment'>-- | Tables are something you can select objects from.</span>
<a name="line-223"></a><span class='hs-comment'>--</span>
<a name="line-224"></a><span class='hs-comment'>-- This type is not exported, and merely serves as a sort of phantom type. On</span>
<a name="line-225"></a><span class='hs-comment'>-- the client tables are converted to a 'Sequence'.</span>
<a name="line-226"></a>
<a name="line-227"></a><a name="Table"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkTable</span>
<a name="line-228"></a>
<a name="line-229"></a><a name="instance%20IsSequence%20Table%20------------------------------------------------------------------------------%20--%20%7c%20'SingleSelection'%20is%20essentially%20a%20'Maybe%20Object',%20where%20'Nothing'%20is%20--%20represented%20with%20'Null'%20in%20the%20network%20protocol.%20data%20SingleSelection%20=%20SingleSelection%20deriving%20(Show)%20instance%20IsDatum%20SingleSelection%20instance%20IsObject%20SingleSelection%20------------------------------------------------------------------------------%20--%20%7c%20A%20'Database'%20is%20something%20which%20contains%20tables.%20It%20is%20a%20server-only%20--%20type.%20data%20Database%20=%20MkDatabase%20------------------------------------------------------------------------------%20--%20%7c%20Bounds%20are%20used%20in%20'Between'.%20data%20Bound%20=%20Open%20!Datum%20%7c%20Closed%20!Datum%20boundDatum%20::%20Bound%20-%3e%20Datum%20boundDatum%20(Open%20x)%20=%20x%20boundDatum%20(Closed%20x)%20=%20x%20boundString%20::%20Bound%20-%3e%20Text%20boundString%20(Open%20_)%20=%20%22open%22%20boundString%20(Closed%20_)%20=%20%22closed%22%20------------------------------------------------------------------------------%20--%20%7c%20ConflictResolutionStrategy%20--%20--%20How%20conflicts%20should%20be%20resolved.%20data%20ConflictResolutionStrategy%20=%20CRError%20--%20%5e%20Do%20not%20insert%20the%20new%20document%20and%20record%20the%20conflict%20as%20an%20error.%20--%20This%20is%20the%20default.%20%7c%20CRReplace%20--%20%5e%20Replace%20the%20old%20document%20in%20its%20entirety%20with%20the%20new%20one.%20%7c%20CRUpdate%20--%20%5e%20Update%20fields%20of%20the%20old%20document%20with%20fields%20from%20the%20new%20one.%20instance%20ToDatum%20ConflictResolutionStrategy"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsSequence</span> <span class='hs-conid'>Table</span>
<a name="line-230"></a>
<a name="line-231"></a>
<a name="line-232"></a>
<a name="line-233"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-234"></a><span class='hs-comment'>-- | 'SingleSelection' is essentially a 'Maybe Object', where 'Nothing' is</span>
<a name="line-235"></a><span class='hs-comment'>-- represented with 'Null' in the network protocol.</span>
<a name="line-236"></a>
<a name="line-237"></a><a name="SingleSelection"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SingleSelection</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SingleSelection</span>
<a name="line-238"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-239"></a>
<a name="line-240"></a><a name="instance%20IsDatum%20SingleSelection%20instance%20IsObject%20SingleSelection%20------------------------------------------------------------------------------%20--%20%7c%20A%20'Database'%20is%20something%20which%20contains%20tables.%20It%20is%20a%20server-only%20--%20type.%20data%20Database%20=%20MkDatabase%20------------------------------------------------------------------------------%20--%20%7c%20Bounds%20are%20used%20in%20'Between'.%20data%20Bound%20=%20Open%20!Datum%20%7c%20Closed%20!Datum%20boundDatum%20::%20Bound%20-%3e%20Datum%20boundDatum%20(Open%20x)%20=%20x%20boundDatum%20(Closed%20x)%20=%20x%20boundString%20::%20Bound%20-%3e%20Text%20boundString%20(Open%20_)%20=%20%22open%22%20boundString%20(Closed%20_)%20=%20%22closed%22%20------------------------------------------------------------------------------%20--%20%7c%20ConflictResolutionStrategy%20--%20--%20How%20conflicts%20should%20be%20resolved.%20data%20ConflictResolutionStrategy%20=%20CRError%20--%20%5e%20Do%20not%20insert%20the%20new%20document%20and%20record%20the%20conflict%20as%20an%20error.%20--%20This%20is%20the%20default.%20%7c%20CRReplace%20--%20%5e%20Replace%20the%20old%20document%20in%20its%20entirety%20with%20the%20new%20one.%20%7c%20CRUpdate%20--%20%5e%20Update%20fields%20of%20the%20old%20document%20with%20fields%20from%20the%20new%20one.%20instance%20ToDatum%20ConflictResolutionStrategy"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsDatum</span>  <span class='hs-conid'>SingleSelection</span>
<a name="line-241"></a><a name="instance%20IsObject%20SingleSelection%20------------------------------------------------------------------------------%20--%20%7c%20A%20'Database'%20is%20something%20which%20contains%20tables.%20It%20is%20a%20server-only%20--%20type.%20data%20Database%20=%20MkDatabase%20------------------------------------------------------------------------------%20--%20%7c%20Bounds%20are%20used%20in%20'Between'.%20data%20Bound%20=%20Open%20!Datum%20%7c%20Closed%20!Datum%20boundDatum%20::%20Bound%20-%3e%20Datum%20boundDatum%20(Open%20x)%20=%20x%20boundDatum%20(Closed%20x)%20=%20x%20boundString%20::%20Bound%20-%3e%20Text%20boundString%20(Open%20_)%20=%20%22open%22%20boundString%20(Closed%20_)%20=%20%22closed%22%20------------------------------------------------------------------------------%20--%20%7c%20ConflictResolutionStrategy%20--%20--%20How%20conflicts%20should%20be%20resolved.%20data%20ConflictResolutionStrategy%20=%20CRError%20--%20%5e%20Do%20not%20insert%20the%20new%20document%20and%20record%20the%20conflict%20as%20an%20error.%20--%20This%20is%20the%20default.%20%7c%20CRReplace%20--%20%5e%20Replace%20the%20old%20document%20in%20its%20entirety%20with%20the%20new%20one.%20%7c%20CRUpdate%20--%20%5e%20Update%20fields%20of%20the%20old%20document%20with%20fields%20from%20the%20new%20one.%20instance%20ToDatum%20ConflictResolutionStrategy"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsObject</span> <span class='hs-conid'>SingleSelection</span>
<a name="line-242"></a>
<a name="line-243"></a>
<a name="line-244"></a>
<a name="line-245"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-246"></a><span class='hs-comment'>-- | A 'Database' is something which contains tables. It is a server-only</span>
<a name="line-247"></a><span class='hs-comment'>-- type.</span>
<a name="line-248"></a>
<a name="line-249"></a><a name="Database"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Database</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkDatabase</span>
<a name="line-250"></a>
<a name="line-251"></a>
<a name="line-252"></a>
<a name="line-253"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-254"></a><span class='hs-comment'>-- | Bounds are used in 'Between'.</span>
<a name="line-255"></a>
<a name="line-256"></a><a name="Bound"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Bound</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Open</span> <span class='hs-varop'>!</span><span class='hs-conid'>Datum</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Closed</span> <span class='hs-varop'>!</span><span class='hs-conid'>Datum</span>
<a name="line-257"></a>
<a name="line-258"></a><a name="boundDatum"></a><span class='hs-definition'>boundDatum</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bound</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Datum</span>
<a name="line-259"></a><span class='hs-definition'>boundDatum</span> <span class='hs-layout'>(</span><span class='hs-conid'>Open</span>   <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-260"></a><span class='hs-definition'>boundDatum</span> <span class='hs-layout'>(</span><span class='hs-conid'>Closed</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-261"></a>
<a name="line-262"></a><a name="boundString"></a><span class='hs-definition'>boundString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bound</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span>
<a name="line-263"></a><span class='hs-definition'>boundString</span> <span class='hs-layout'>(</span><span class='hs-conid'>Open</span>   <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"open"</span>
<a name="line-264"></a><span class='hs-definition'>boundString</span> <span class='hs-layout'>(</span><span class='hs-conid'>Closed</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"closed"</span>
<a name="line-265"></a>
<a name="line-266"></a>
<a name="line-267"></a>
<a name="line-268"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-269"></a><span class='hs-comment'>-- | ConflictResolutionStrategy</span>
<a name="line-270"></a><span class='hs-comment'>--</span>
<a name="line-271"></a><span class='hs-comment'>-- How conflicts should be resolved.</span>
<a name="line-272"></a>
<a name="line-273"></a><a name="ConflictResolutionStrategy"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConflictResolutionStrategy</span>
<a name="line-274"></a>
<a name="line-275"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CRError</span>
<a name="line-276"></a>      <span class='hs-comment'>-- ^ Do not insert the new document and record the conflict as an error.</span>
<a name="line-277"></a>      <span class='hs-comment'>-- This is the default.</span>
<a name="line-278"></a>
<a name="line-279"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CRReplace</span>
<a name="line-280"></a>      <span class='hs-comment'>-- ^ Replace the old document in its entirety with the new one.</span>
<a name="line-281"></a>
<a name="line-282"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CRUpdate</span>
<a name="line-283"></a>      <span class='hs-comment'>-- ^ Update fields of the old document with fields from the new one.</span>
<a name="line-284"></a>
<a name="line-285"></a>
<a name="line-286"></a><a name="instance%20ToDatum%20ConflictResolutionStrategy"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>ToDatum</span> <span class='hs-conid'>ConflictResolutionStrategy</span> <span class='hs-keyword'>where</span>
<a name="line-287"></a>    <span class='hs-varid'>toDatum</span> <span class='hs-conid'>CRError</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>String</span> <span class='hs-str'>"error"</span>
<a name="line-288"></a>    <span class='hs-varid'>toDatum</span> <span class='hs-conid'>CRReplace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>String</span> <span class='hs-str'>"replace"</span>
<a name="line-289"></a>    <span class='hs-varid'>toDatum</span> <span class='hs-conid'>CRUpdate</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>String</span> <span class='hs-str'>"update"</span>
<a name="line-290"></a>
<a name="line-291"></a>
<a name="line-292"></a>
<a name="line-293"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-294"></a><span class='hs-comment'>-- | Used in 'OrderBy'.</span>
<a name="line-295"></a>
<a name="line-296"></a><a name="Order"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Order</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Ascending</span> <span class='hs-varop'>!</span><span class='hs-conid'>Text</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Descending</span> <span class='hs-varop'>!</span><span class='hs-conid'>Text</span>
<a name="line-297"></a>
<a name="line-298"></a><a name="instance%20Term%20Order"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>Order</span> <span class='hs-keyword'>where</span>
<a name="line-299"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ascending</span>  <span class='hs-varid'>key</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>73</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-varid'>key</span><span class='hs-keyglyph'>]</span>
<a name="line-300"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Descending</span> <span class='hs-varid'>key</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>74</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-varid'>key</span><span class='hs-keyglyph'>]</span>
<a name="line-301"></a>
<a name="line-302"></a>
<a name="line-303"></a>
<a name="line-304"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-305"></a><span class='hs-comment'>-- | Sequences are a bounded list of items. The server may split the sequence</span>
<a name="line-306"></a><span class='hs-comment'>-- into multiple chunks when sending it to the client. When the response is</span>
<a name="line-307"></a><span class='hs-comment'>-- a partial sequence, the client may request additional chunks until it gets</span>
<a name="line-308"></a><span class='hs-comment'>-- a 'Done'.</span>
<a name="line-309"></a>
<a name="line-310"></a><a name="Sequence"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span>
<a name="line-311"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Done</span>    <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Vector</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-312"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Partial</span> <span class='hs-varop'>!</span><span class='hs-conid'>Token</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Vector</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-313"></a>
<a name="line-314"></a>
<a name="line-315"></a><a name="IsSequence"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>IsSequence</span> <span class='hs-varid'>a</span>
<a name="line-316"></a>
<a name="line-317"></a>
<a name="line-318"></a><a name="instance%20Show%20(Sequence%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-319"></a>    <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Done</span>      <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Done "</span> <span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>length</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-320"></a>    <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Partial</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Partial "</span> <span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>length</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-321"></a>
<a name="line-322"></a><a name="instance%20FromResponse%20(Sequence%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>FromResponse</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-323"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>responseSequenceParser</span>
<a name="line-324"></a>
<a name="line-325"></a><a name="instance%20FromDatum%20(Sequence%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsSequence</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-326"></a>
<a name="line-327"></a><a name="instance%20FromDatum%20(Sequence%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>FromDatum</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-328"></a>    <span class='hs-varid'>parseDatum</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Done</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>mapM</span> <span class='hs-varid'>parseDatum</span> <span class='hs-varid'>x</span>
<a name="line-329"></a>    <span class='hs-varid'>parseDatum</span> <span class='hs-keyword'>_</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fail</span> <span class='hs-str'>"Sequence"</span>
<a name="line-330"></a>
<a name="line-331"></a>
<a name="line-332"></a>
<a name="line-333"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-334"></a>
<a name="line-335"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-336"></a>    <span class='hs-conid'>Constant</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>ToDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span>
<a name="line-337"></a>    <span class='hs-comment'>-- Any object which can be converted to RSON can be treated as a constant.</span>
<a name="line-338"></a>    <span class='hs-comment'>-- Furthermore, many basic Haskell types have a 'Lift' instance which turns</span>
<a name="line-339"></a>    <span class='hs-comment'>-- their values into constants.</span>
<a name="line-340"></a>
<a name="line-341"></a>
<a name="line-342"></a>    <span class='hs-comment'>--------------------------------------------------------------------------</span>
<a name="line-343"></a>    <span class='hs-comment'>-- Database administration</span>
<a name="line-344"></a>
<a name="line-345"></a>    <span class='hs-conid'>ListDatabases</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-346"></a>    <span class='hs-conid'>CreateDatabase</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-347"></a>    <span class='hs-conid'>DropDatabase</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-348"></a>
<a name="line-349"></a>
<a name="line-350"></a>    <span class='hs-comment'>--------------------------------------------------------------------------</span>
<a name="line-351"></a>    <span class='hs-comment'>-- Table administration</span>
<a name="line-352"></a>
<a name="line-353"></a>    <span class='hs-conid'>ListTables</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Database</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-354"></a>    <span class='hs-conid'>CreateTable</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Database</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-355"></a>    <span class='hs-conid'>DropTable</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Database</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-356"></a>
<a name="line-357"></a>
<a name="line-358"></a>    <span class='hs-comment'>--------------------------------------------------------------------------</span>
<a name="line-359"></a>    <span class='hs-comment'>-- Index administration</span>
<a name="line-360"></a>
<a name="line-361"></a>    <span class='hs-conid'>ListIndices</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-362"></a>
<a name="line-363"></a>    <span class='hs-conid'>CreateIndex</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-364"></a>    <span class='hs-comment'>-- Create a new secondary index on the table. The index has a name and a</span>
<a name="line-365"></a>    <span class='hs-comment'>-- projection function which is applied to every object which is added to the table.</span>
<a name="line-366"></a>
<a name="line-367"></a>    <span class='hs-conid'>DropIndex</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-368"></a>    <span class='hs-conid'>IndexStatus</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Object</span><span class='hs-layout'>)</span>
<a name="line-369"></a>    <span class='hs-conid'>WaitIndex</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-370"></a>
<a name="line-371"></a>
<a name="line-372"></a>    <span class='hs-conid'>Database</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Database</span>
<a name="line-373"></a>    <span class='hs-conid'>Table</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Database</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span>
<a name="line-374"></a>
<a name="line-375"></a>    <span class='hs-conid'>Coerce</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span>
<a name="line-376"></a>    <span class='hs-conid'>Eq</span>             <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>IsDatum</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span>
<a name="line-377"></a>    <span class='hs-conid'>Ne</span>             <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>IsDatum</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span>
<a name="line-378"></a>    <span class='hs-conid'>Not</span>            <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span>
<a name="line-379"></a>
<a name="line-380"></a>    <span class='hs-conid'>Match</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Datum</span>
<a name="line-381"></a>    <span class='hs-comment'>-- First arg is the string, second a regular expression.</span>
<a name="line-382"></a>
<a name="line-383"></a>    <span class='hs-conid'>Get</span>            <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>SingleSelection</span>
<a name="line-384"></a>    <span class='hs-conid'>GetAll</span>         <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span>
<a name="line-385"></a>    <span class='hs-conid'>GetAllIndexed</span>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span>
<a name="line-386"></a>
<a name="line-387"></a>    <span class='hs-conid'>Add</span>            <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span>
<a name="line-388"></a>    <span class='hs-conid'>Multiply</span>       <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Num</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span>
<a name="line-389"></a>
<a name="line-390"></a>    <span class='hs-conid'>All</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span>
<a name="line-391"></a>    <span class='hs-comment'>-- True if all the elements in the input are True.</span>
<a name="line-392"></a>
<a name="line-393"></a>    <span class='hs-conid'>Any</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span>
<a name="line-394"></a>    <span class='hs-comment'>-- True if any element in the input is True.</span>
<a name="line-395"></a>
<a name="line-396"></a>    <span class='hs-conid'>GetField</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsObject</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>IsDatum</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span>
<a name="line-397"></a>    <span class='hs-comment'>-- Get a particular field from an object (or SingleSelection).</span>
<a name="line-398"></a>
<a name="line-399"></a>    <span class='hs-conid'>HasFields</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsObject</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Text</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span>
<a name="line-400"></a>    <span class='hs-comment'>-- True if the object has all the given fields.</span>
<a name="line-401"></a>
<a name="line-402"></a>    <span class='hs-conid'>Take</span>           <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span>
<a name="line-403"></a>    <span class='hs-conid'>Append</span>         <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-404"></a>    <span class='hs-conid'>Prepend</span>        <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-405"></a>    <span class='hs-conid'>IsEmpty</span>        <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span>
<a name="line-406"></a>    <span class='hs-conid'>Delete</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-407"></a>
<a name="line-408"></a>    <span class='hs-conid'>InsertObject</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ConflictResolutionStrategy</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Object</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-409"></a>    <span class='hs-comment'>-- Insert a single object into the table.</span>
<a name="line-410"></a>
<a name="line-411"></a>    <span class='hs-conid'>InsertSequence</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Table</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-412"></a>    <span class='hs-comment'>-- Insert a sequence into the table.</span>
<a name="line-413"></a>
<a name="line-414"></a>    <span class='hs-conid'>Filter</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span>
<a name="line-415"></a>    <span class='hs-conid'>Map</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-416"></a>
<a name="line-417"></a>    <span class='hs-conid'>Between</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bound</span><span class='hs-layout'>,</span> <span class='hs-conid'>Bound</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span>
<a name="line-418"></a>    <span class='hs-comment'>-- Select all elements whose primary key is between the two bounds.</span>
<a name="line-419"></a>
<a name="line-420"></a>    <span class='hs-conid'>BetweenIndexed</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Bound</span><span class='hs-layout'>,</span> <span class='hs-conid'>Bound</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span>
<a name="line-421"></a>    <span class='hs-comment'>-- Select all elements whose secondary index is between the two bounds.</span>
<a name="line-422"></a>
<a name="line-423"></a>    <span class='hs-conid'>OrderBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Order</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span>
<a name="line-424"></a>    <span class='hs-comment'>-- Order a sequence based on the given order specificiation.</span>
<a name="line-425"></a>
<a name="line-426"></a>    <span class='hs-conid'>OrderByIndexed</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Order</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span>
<a name="line-427"></a>    <span class='hs-comment'>-- Like OrderBy but uses a secondary index instead of a object field.</span>
<a name="line-428"></a>
<a name="line-429"></a>    <span class='hs-conid'>Keys</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsObject</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-430"></a>
<a name="line-431"></a>    <span class='hs-conid'>Var</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span>
<a name="line-432"></a>    <span class='hs-comment'>-- A 'Var' is used as a placeholder in input to functions.</span>
<a name="line-433"></a>
<a name="line-434"></a>    <span class='hs-conid'>Function</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>State</span> <span class='hs-conid'>Context</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Int</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>f</span>
<a name="line-435"></a>    <span class='hs-comment'>-- Creates a function. The action should take care of allocating an</span>
<a name="line-436"></a>    <span class='hs-comment'>-- appropriate number of variables from the context. Note that you should</span>
<a name="line-437"></a>    <span class='hs-comment'>-- not use this constructor directly. There are 'Lift' instances for all</span>
<a name="line-438"></a>    <span class='hs-comment'>-- commonly used functions.</span>
<a name="line-439"></a>
<a name="line-440"></a>    <span class='hs-conid'>Call</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span>
<a name="line-441"></a>    <span class='hs-comment'>-- Call the given function. The function should take the same number of</span>
<a name="line-442"></a>    <span class='hs-comment'>-- arguments as there are provided.</span>
<a name="line-443"></a>
<a name="line-444"></a>    <span class='hs-conid'>Limit</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span>
<a name="line-445"></a>    <span class='hs-comment'>-- Limit the number of items in the sequence.</span>
<a name="line-446"></a>
<a name="line-447"></a>    <span class='hs-conid'>Nth</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsSequence</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>IsDatum</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span>
<a name="line-448"></a>    <span class='hs-comment'>-- Return the n-th element in the sequence.</span>
<a name="line-449"></a>
<a name="line-450"></a>    <span class='hs-conid'>UUID</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span>
<a name="line-451"></a>    <span class='hs-comment'>-- An expression which when evaluated will generate a fresh UUID (in its</span>
<a name="line-452"></a>    <span class='hs-comment'>-- standard string encoding).</span>
<a name="line-453"></a>
<a name="line-454"></a>    <span class='hs-conid'>Now</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>ZonedTime</span>
<a name="line-455"></a>    <span class='hs-comment'>-- The time when the query was received by the server.</span>
<a name="line-456"></a>
<a name="line-457"></a>    <span class='hs-conid'>Timezone</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>ZonedTime</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span>
<a name="line-458"></a>    <span class='hs-comment'>-- The timezone in which the given time is.</span>
<a name="line-459"></a>
<a name="line-460"></a>    <span class='hs-conid'>RandomInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Int</span>
<a name="line-461"></a>    <span class='hs-comment'>-- Takes a lower and upper bound and returns a random integer between</span>
<a name="line-462"></a>    <span class='hs-comment'>-- the two. Note that the lower bound is closed, the upper bound is open,</span>
<a name="line-463"></a>    <span class='hs-comment'>-- ie: [min, max)</span>
<a name="line-464"></a>
<a name="line-465"></a>    <span class='hs-conid'>RandomFloat</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Double</span>
<a name="line-466"></a>    <span class='hs-comment'>-- Same as 'RandomInteger' but uses floating-point numbers.</span>
<a name="line-467"></a>
<a name="line-468"></a>    <span class='hs-conid'>Info</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span>
<a name="line-469"></a>    <span class='hs-comment'>-- Gets info about anything.</span>
<a name="line-470"></a>
<a name="line-471"></a>    <span class='hs-conid'>Default</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span>
<a name="line-472"></a>    <span class='hs-comment'>-- Evaluate the first argument. If it throws an error then the second</span>
<a name="line-473"></a>    <span class='hs-comment'>-- argument is returned.</span>
<a name="line-474"></a>
<a name="line-475"></a>    <span class='hs-conid'>Error</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span>
<a name="line-476"></a>    <span class='hs-comment'>-- Throw an error with the given message.</span>
<a name="line-477"></a>
<a name="line-478"></a>
<a name="line-479"></a><a name="instance%20Term%20(Exp%20a)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-480"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Constant</span> <span class='hs-varid'>datum</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-481"></a>        <span class='hs-varid'>toTerm</span> <span class='hs-varop'>$</span> <span class='hs-varid'>toDatum</span> <span class='hs-varid'>datum</span>
<a name="line-482"></a>
<a name="line-483"></a>
<a name="line-484"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-conid'>ListDatabases</span> <span class='hs-keyglyph'>=</span>
<a name="line-485"></a>        <span class='hs-varid'>noargTerm</span> <span class='hs-num'>59</span>
<a name="line-486"></a>
<a name="line-487"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>CreateDatabase</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-488"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>57</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-489"></a>
<a name="line-490"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>DropDatabase</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-491"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>58</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-492"></a>
<a name="line-493"></a>
<a name="line-494"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListTables</span> <span class='hs-varid'>db</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-495"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>62</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>db</span><span class='hs-keyglyph'>]</span>
<a name="line-496"></a>
<a name="line-497"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>CreateTable</span> <span class='hs-varid'>db</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-498"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>60</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>db</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-499"></a>
<a name="line-500"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>DropTable</span> <span class='hs-varid'>db</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-501"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>61</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>db</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-502"></a>
<a name="line-503"></a>
<a name="line-504"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListIndices</span> <span class='hs-varid'>table</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-505"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>77</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-keyglyph'>]</span>
<a name="line-506"></a>
<a name="line-507"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>CreateIndex</span> <span class='hs-varid'>table</span> <span class='hs-varid'>name</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-508"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>75</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-509"></a>
<a name="line-510"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>DropIndex</span> <span class='hs-varid'>table</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-511"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>76</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-512"></a>
<a name="line-513"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>IndexStatus</span> <span class='hs-varid'>table</span> <span class='hs-varid'>indices</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-514"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>139</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>indices</span><span class='hs-layout'>)</span>
<a name="line-515"></a>
<a name="line-516"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>WaitIndex</span> <span class='hs-varid'>table</span> <span class='hs-varid'>indices</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-517"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>140</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>indices</span><span class='hs-layout'>)</span>
<a name="line-518"></a>
<a name="line-519"></a>
<a name="line-520"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Database</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-521"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>14</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-522"></a>
<a name="line-523"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Table</span> <span class='hs-varid'>mbDatabase</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-524"></a>        <span class='hs-varid'>db</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>gets</span> <span class='hs-varid'>defaultDatabase</span><span class='hs-layout'>)</span> <span class='hs-varid'>pure</span> <span class='hs-varid'>mbDatabase</span>
<a name="line-525"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>15</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>db</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-526"></a>
<a name="line-527"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Filter</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-528"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>39</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-529"></a>
<a name="line-530"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>f</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-531"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>38</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-532"></a>
<a name="line-533"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Between</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-534"></a>        <span class='hs-varid'>termWithOptions</span> <span class='hs-num'>36</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundDatum</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundDatum</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span>
<a name="line-535"></a>            <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span>
<a name="line-536"></a>                <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span><span class='hs-str'>"left_bound"</span><span class='hs-layout'>,</span>  <span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundString</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-537"></a>                <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-str'>"right_bound"</span><span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundString</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-538"></a>                <span class='hs-keyglyph'>]</span>
<a name="line-539"></a>
<a name="line-540"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>BetweenIndexed</span> <span class='hs-varid'>index</span> <span class='hs-layout'>(</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-541"></a>        <span class='hs-varid'>termWithOptions</span> <span class='hs-num'>36</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundDatum</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundDatum</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span>
<a name="line-542"></a>            <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span>
<a name="line-543"></a>                <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span><span class='hs-str'>"left_bound"</span><span class='hs-layout'>,</span>  <span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundString</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-544"></a>                <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-str'>"right_bound"</span><span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-conid'>String</span> <span class='hs-layout'>(</span><span class='hs-varid'>boundString</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-545"></a>                <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-str'>"index"</span><span class='hs-layout'>,</span>       <span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-conid'>String</span> <span class='hs-varid'>index</span><span class='hs-layout'>)</span>
<a name="line-546"></a>                <span class='hs-keyglyph'>]</span>
<a name="line-547"></a>
<a name="line-548"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>OrderBy</span> <span class='hs-varid'>spec</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-549"></a>        <span class='hs-varid'>s'</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>s</span>
<a name="line-550"></a>        <span class='hs-varid'>spec'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>spec</span>
<a name="line-551"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>41</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>s'</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>spec'</span><span class='hs-layout'>)</span>
<a name="line-552"></a>
<a name="line-553"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>OrderByIndexed</span> <span class='hs-varid'>spec</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-554"></a>        <span class='hs-varid'>s'</span>    <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>s</span>
<a name="line-555"></a>        <span class='hs-varid'>spec'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>spec</span>
<a name="line-556"></a>        <span class='hs-varid'>termWithOptions</span> <span class='hs-num'>41</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>s'</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span> <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"index"</span> <span class='hs-varid'>spec'</span>
<a name="line-557"></a>
<a name="line-558"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>InsertObject</span> <span class='hs-varid'>crs</span> <span class='hs-varid'>table</span> <span class='hs-varid'>obj</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-559"></a>        <span class='hs-varid'>termWithOptions</span> <span class='hs-num'>56</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>obj</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span>
<a name="line-560"></a>            <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"conflict"</span> <span class='hs-layout'>(</span><span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-varid'>toDatum</span> <span class='hs-varid'>crs</span><span class='hs-layout'>)</span>
<a name="line-561"></a>
<a name="line-562"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>InsertSequence</span> <span class='hs-varid'>table</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-563"></a>        <span class='hs-varid'>termWithOptions</span> <span class='hs-num'>56</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-564"></a>
<a name="line-565"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Delete</span> <span class='hs-varid'>selection</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-566"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>54</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>selection</span><span class='hs-keyglyph'>]</span>
<a name="line-567"></a>
<a name="line-568"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>GetField</span> <span class='hs-varid'>field</span> <span class='hs-varid'>obj</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-569"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>31</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>obj</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>field</span><span class='hs-keyglyph'>]</span>
<a name="line-570"></a>
<a name="line-571"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>HasFields</span> <span class='hs-varid'>fields</span> <span class='hs-varid'>obj</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-572"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>32</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>obj</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeExp</span> <span class='hs-varop'>.</span> <span class='hs-varid'>lift</span><span class='hs-layout'>)</span> <span class='hs-varid'>fields</span><span class='hs-layout'>)</span>
<a name="line-573"></a>
<a name="line-574"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Coerce</span> <span class='hs-varid'>value</span> <span class='hs-varid'>typeName</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-575"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>51</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>value</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>typeName</span><span class='hs-keyglyph'>]</span>
<a name="line-576"></a>
<a name="line-577"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Add</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-578"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>24</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span>
<a name="line-579"></a>
<a name="line-580"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Multiply</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-581"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>26</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span>
<a name="line-582"></a>
<a name="line-583"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>All</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-584"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>67</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span>
<a name="line-585"></a>
<a name="line-586"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Any</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-587"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>66</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>values</span><span class='hs-layout'>)</span>
<a name="line-588"></a>
<a name="line-589"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-590"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>17</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-591"></a>
<a name="line-592"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ne</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-593"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>18</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-594"></a>
<a name="line-595"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Not</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-596"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>23</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-597"></a>
<a name="line-598"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-varid'>str</span> <span class='hs-varid'>re</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-599"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>97</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>str</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>re</span><span class='hs-keyglyph'>]</span>
<a name="line-600"></a>
<a name="line-601"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Get</span> <span class='hs-varid'>table</span> <span class='hs-varid'>key</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-602"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>16</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>key</span><span class='hs-keyglyph'>]</span>
<a name="line-603"></a>
<a name="line-604"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>GetAll</span> <span class='hs-varid'>table</span> <span class='hs-varid'>keys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-605"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>78</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>keys</span><span class='hs-layout'>)</span>
<a name="line-606"></a>
<a name="line-607"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>GetAllIndexed</span> <span class='hs-varid'>table</span> <span class='hs-varid'>keys</span> <span class='hs-varid'>index</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-608"></a>        <span class='hs-varid'>termWithOptions</span> <span class='hs-num'>78</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>table</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>keys</span><span class='hs-layout'>)</span>
<a name="line-609"></a>            <span class='hs-layout'>(</span><span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"index"</span> <span class='hs-layout'>(</span><span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-conid'>String</span> <span class='hs-varid'>index</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-610"></a>
<a name="line-611"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Take</span> <span class='hs-varid'>n</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-612"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>71</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span>
<a name="line-613"></a>
<a name="line-614"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Append</span> <span class='hs-varid'>array</span> <span class='hs-varid'>value</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-615"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>29</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>array</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>value</span><span class='hs-keyglyph'>]</span>
<a name="line-616"></a>
<a name="line-617"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prepend</span> <span class='hs-varid'>array</span> <span class='hs-varid'>value</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-618"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>80</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>array</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>value</span><span class='hs-keyglyph'>]</span>
<a name="line-619"></a>
<a name="line-620"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>IsEmpty</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-621"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>86</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span>
<a name="line-622"></a>
<a name="line-623"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Keys</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-624"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>94</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-625"></a>
<a name="line-626"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-627"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>10</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-628"></a>
<a name="line-629"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Function</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-630"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>vars</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>a</span>
<a name="line-631"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>69</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Constant</span> <span class='hs-varop'>$</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-conid'>Number</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromIntegral</span><span class='hs-layout'>)</span> <span class='hs-varid'>vars</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>f</span><span class='hs-keyglyph'>]</span>
<a name="line-632"></a>
<a name="line-633"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Call</span> <span class='hs-varid'>f</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-634"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>64</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>f</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-635"></a>
<a name="line-636"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Limit</span> <span class='hs-varid'>n</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-637"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>71</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-638"></a>
<a name="line-639"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nth</span> <span class='hs-varid'>n</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-640"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>45</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>s</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-641"></a>
<a name="line-642"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-conid'>UUID</span> <span class='hs-keyglyph'>=</span>
<a name="line-643"></a>        <span class='hs-varid'>noargTerm</span> <span class='hs-num'>169</span>
<a name="line-644"></a>
<a name="line-645"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-conid'>Now</span> <span class='hs-keyglyph'>=</span>
<a name="line-646"></a>        <span class='hs-varid'>noargTerm</span> <span class='hs-num'>103</span>
<a name="line-647"></a>
<a name="line-648"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Timezone</span> <span class='hs-varid'>time</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-649"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>127</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>time</span><span class='hs-keyglyph'>]</span>
<a name="line-650"></a>
<a name="line-651"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>RandomInteger</span> <span class='hs-varid'>lo</span> <span class='hs-varid'>hi</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-652"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>151</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>lo</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>hi</span><span class='hs-keyglyph'>]</span>
<a name="line-653"></a>
<a name="line-654"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>RandomFloat</span> <span class='hs-varid'>lo</span> <span class='hs-varid'>hi</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-655"></a>        <span class='hs-varid'>termWithOptions</span> <span class='hs-num'>151</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>lo</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>hi</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span>
<a name="line-656"></a>            <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"float"</span> <span class='hs-layout'>(</span><span class='hs-varid'>toJSON</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Bool</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-657"></a>
<a name="line-658"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Info</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-659"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>79</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-660"></a>
<a name="line-661"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Default</span> <span class='hs-varid'>action</span> <span class='hs-varid'>def</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-662"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>92</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>action</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>def</span><span class='hs-keyglyph'>]</span>
<a name="line-663"></a>
<a name="line-664"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>Error</span> <span class='hs-varid'>message</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-665"></a>        <span class='hs-varid'>simpleTerm</span> <span class='hs-num'>12</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>message</span><span class='hs-keyglyph'>]</span>
<a name="line-666"></a>
<a name="line-667"></a>
<a name="line-668"></a><a name="noargTerm"></a><span class='hs-definition'>noargTerm</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span> <span class='hs-conid'>Context</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Value</span>
<a name="line-669"></a><span class='hs-definition'>noargTerm</span> <span class='hs-varid'>termType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span> <span class='hs-varop'>$</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>toJSON</span> <span class='hs-varid'>termType</span><span class='hs-keyglyph'>]</span>
<a name="line-670"></a>
<a name="line-671"></a><a name="simpleTerm"></a><span class='hs-definition'>simpleTerm</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Term</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span> <span class='hs-conid'>Context</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Value</span>
<a name="line-672"></a><span class='hs-definition'>simpleTerm</span> <span class='hs-varid'>termType</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-673"></a>    <span class='hs-varid'>args'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>args</span>
<a name="line-674"></a>    <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span> <span class='hs-varop'>$</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>toJSON</span> <span class='hs-varid'>termType</span><span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span> <span class='hs-varid'>args'</span><span class='hs-keyglyph'>]</span>
<a name="line-675"></a>
<a name="line-676"></a><a name="termWithOptions"></a><span class='hs-definition'>termWithOptions</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Term</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>HashMap</span> <span class='hs-conid'>Text</span> <span class='hs-conid'>Value</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>State</span> <span class='hs-conid'>Context</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Value</span>
<a name="line-677"></a><span class='hs-definition'>termWithOptions</span> <span class='hs-varid'>termType</span> <span class='hs-varid'>args</span> <span class='hs-varid'>options</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-678"></a>    <span class='hs-varid'>args'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>args</span>
<a name="line-679"></a>    <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Array</span> <span class='hs-varop'>$</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>toJSON</span> <span class='hs-varid'>termType</span><span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span> <span class='hs-varid'>args'</span><span class='hs-layout'>,</span> <span class='hs-varid'>toJSON</span> <span class='hs-varid'>options</span><span class='hs-keyglyph'>]</span>
<a name="line-680"></a>
<a name="line-681"></a>
<a name="line-682"></a><a name="instance%20IsString%20(Exp%20Text)"></a><span class='hs-comment'>-- | Convenience to for automatically converting a 'Text' to a constant</span>
<a name="line-683"></a><a name="instance%20IsString%20(Exp%20Text)"></a><span class='hs-comment'>-- expression.</span>
<a name="line-684"></a><a name="instance%20IsString%20(Exp%20Text)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>IsString</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-685"></a>    <span class='hs-varid'>fromString</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-686"></a>
<a name="line-687"></a>
<a name="line-688"></a><a name="instance%20Num%20(Exp%20Double)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Num</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-689"></a>    <span class='hs-varid'>fromInteger</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromInteger</span>
<a name="line-690"></a>
<a name="line-691"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>+</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Add</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-692"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>*</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Multiply</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-693"></a>
<a name="line-694"></a>    <span class='hs-varid'>abs</span> <span class='hs-keyword'>_</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Num (Exp a): abs not implemented"</span>
<a name="line-695"></a>    <span class='hs-varid'>signum</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Num (Exp a): signum not implemented"</span>
<a name="line-696"></a>    <span class='hs-varid'>negate</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>error</span> <span class='hs-str'>"Num (Exp a): negate not implemented"</span>
<a name="line-697"></a>
<a name="line-698"></a>
<a name="line-699"></a>
<a name="line-700"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-701"></a><span class='hs-comment'>-- | The class of types e which can be lifted into c. All basic Haskell types</span>
<a name="line-702"></a><span class='hs-comment'>-- which can be represented as 'Exp' are instances of this, as well as certain</span>
<a name="line-703"></a><span class='hs-comment'>-- types of functions (unary and binary).</span>
<a name="line-704"></a>
<a name="line-705"></a><a name="Lift"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Lift</span> <span class='hs-varid'>c</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>where</span>
<a name="line-706"></a>    <span class='hs-comment'>-- | Type-level function which simplifies the type of @e@ once it is lifted</span>
<a name="line-707"></a>    <span class='hs-comment'>-- into @c@. This is used for functions where we strip the signature so</span>
<a name="line-708"></a>    <span class='hs-comment'>-- that we don't have to define dummy 'Term' instances for those.</span>
<a name="line-709"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-varid'>e</span>
<a name="line-710"></a>
<a name="line-711"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-layout'>(</span><span class='hs-conid'>Simplified</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-712"></a>
<a name="line-713"></a>
<a name="line-714"></a><a name="instance%20Lift%20Exp%20Bool"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Bool</span> <span class='hs-keyword'>where</span>
<a name="line-715"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Bool</span>
<a name="line-716"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-717"></a>
<a name="line-718"></a><a name="instance%20Lift%20Exp%20Int"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Int</span> <span class='hs-keyword'>where</span>
<a name="line-719"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Int</span>
<a name="line-720"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-721"></a>
<a name="line-722"></a><a name="instance%20Lift%20Exp%20Double"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Double</span> <span class='hs-keyword'>where</span>
<a name="line-723"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Double</span>
<a name="line-724"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-725"></a>
<a name="line-726"></a><a name="instance%20Lift%20Exp%20Text"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Text</span> <span class='hs-keyword'>where</span>
<a name="line-727"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Text</span>
<a name="line-728"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-729"></a>
<a name="line-730"></a><a name="instance%20Lift%20Exp%20Object"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Object</span> <span class='hs-keyword'>where</span>
<a name="line-731"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>Object</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Object</span>
<a name="line-732"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-733"></a>
<a name="line-734"></a><a name="instance%20Lift%20Exp%20Datum"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>Datum</span> <span class='hs-keyword'>where</span>
<a name="line-735"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>Datum</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Datum</span>
<a name="line-736"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-737"></a>
<a name="line-738"></a><a name="instance%20Lift%20Exp%20ZonedTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>ZonedTime</span> <span class='hs-keyword'>where</span>
<a name="line-739"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>ZonedTime</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ZonedTime</span>
<a name="line-740"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-741"></a>
<a name="line-742"></a><a name="instance%20Lift%20Exp%20UTCTime"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-conid'>UTCTime</span> <span class='hs-keyword'>where</span>
<a name="line-743"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-conid'>UTCTime</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ZonedTime</span>
<a name="line-744"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span> <span class='hs-varop'>.</span> <span class='hs-varid'>utcToZonedTime</span> <span class='hs-varid'>utc</span>
<a name="line-745"></a>
<a name="line-746"></a><a name="instance%20Lift%20Exp%20(Array%20Datum)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-747"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-conid'>Datum</span><span class='hs-layout'>)</span>
<a name="line-748"></a>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Constant</span>
<a name="line-749"></a>
<a name="line-750"></a><a name="instance%20Lift%20Exp%20(Exp%20a%20-%3e%20Exp%20r)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-751"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span>
<a name="line-752"></a>    <span class='hs-varid'>lift</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Function</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-753"></a>        <span class='hs-varid'>v1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newVar</span>
<a name="line-754"></a>        <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>v1</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>v1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-755"></a>
<a name="line-756"></a><a name="instance%20Lift%20Exp%20(Exp%20a%20-%3e%20Exp%20b%20-%3e%20Exp%20r)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Lift</span> <span class='hs-conid'>Exp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-757"></a>    <span class='hs-keyword'>type</span> <span class='hs-conid'>Simplified</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span>
<a name="line-758"></a>    <span class='hs-varid'>lift</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Function</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-759"></a>        <span class='hs-varid'>v1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newVar</span>
<a name="line-760"></a>        <span class='hs-varid'>v2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newVar</span>
<a name="line-761"></a>        <span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>v1</span><span class='hs-layout'>,</span> <span class='hs-varid'>v2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>v1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Var</span> <span class='hs-varid'>v2</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-762"></a>
<a name="line-763"></a>
<a name="line-764"></a>
<a name="line-765"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-766"></a><span class='hs-comment'>-- 'call1', 'call2' etc generate a function call expression. These should be</span>
<a name="line-767"></a><span class='hs-comment'>-- used instead of the 'Call' constructor because they provide type safety.</span>
<a name="line-768"></a>
<a name="line-769"></a><a name="call1"></a><span class='hs-comment'>-- | Call an unary function with the given argument.</span>
<a name="line-770"></a><span class='hs-definition'>call1</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span>
<a name="line-771"></a><span class='hs-definition'>call1</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Call</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-772"></a>
<a name="line-773"></a>
<a name="line-774"></a><a name="call2"></a><span class='hs-comment'>-- | Call an binary function with the given arguments.</span>
<a name="line-775"></a><span class='hs-definition'>call2</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>r</span>
<a name="line-776"></a><span class='hs-definition'>call2</span> <span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Call</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>SomeExp</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-777"></a>
<a name="line-778"></a>
<a name="line-779"></a><a name="emptyOptions"></a><span class='hs-definition'>emptyOptions</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Object</span>
<a name="line-780"></a><span class='hs-definition'>emptyOptions</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HMS</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span>
<a name="line-781"></a>
<a name="line-782"></a>
<a name="line-783"></a>
<a name="line-784"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-785"></a><span class='hs-comment'>-- | Because the arguments to functions are polymorphic (the individual</span>
<a name="line-786"></a><span class='hs-comment'>-- arguments can, and often have, different types).</span>
<a name="line-787"></a>
<a name="line-788"></a><a name="SomeExp"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SomeExp</span> <span class='hs-keyword'>where</span>
<a name="line-789"></a>     <span class='hs-conid'>SomeExp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Exp</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SomeExp</span>
<a name="line-790"></a>
<a name="line-791"></a><a name="instance%20Term%20SomeExp"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Term</span> <span class='hs-conid'>SomeExp</span> <span class='hs-keyword'>where</span>
<a name="line-792"></a>    <span class='hs-varid'>toTerm</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeExp</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toTerm</span> <span class='hs-varid'>e</span>
<a name="line-793"></a>
<a name="line-794"></a>
<a name="line-795"></a>
<a name="line-796"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-797"></a><span class='hs-comment'>-- | The type of result you get when executing a query of 'Exp a'.</span>
<a name="line-798"></a><span class='hs-keyword'>type</span> <span class='hs-varid'>family</span> <span class='hs-conid'>Result</span> <span class='hs-varid'>a</span>
<a name="line-799"></a>
<a name="line-800"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>Text</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Text</span>
<a name="line-801"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>Double</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Double</span>
<a name="line-802"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>Int</span>             <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Int</span>
<a name="line-803"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>Bool</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Bool</span>
<a name="line-804"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>ZonedTime</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ZonedTime</span>
<a name="line-805"></a>
<a name="line-806"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>Table</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Sequence</span> <span class='hs-conid'>Datum</span>
<a name="line-807"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>Datum</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Datum</span>
<a name="line-808"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>Object</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Object</span>
<a name="line-809"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-layout'>(</span><span class='hs-conid'>Array</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Array</span> <span class='hs-varid'>a</span>
<a name="line-810"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-conid'>SingleSelection</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Datum</span>
<a name="line-811"></a><span class='hs-keyword'>type</span> <span class='hs-keyword'>instance</span> <span class='hs-conid'>Result</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span>
<a name="line-812"></a>
<a name="line-813"></a>
<a name="line-814"></a>
<a name="line-815"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-816"></a><span class='hs-comment'>-- | The result of a query. It is either an error or a result (which depends</span>
<a name="line-817"></a><span class='hs-comment'>-- on the type of the query expression). This type is named to be symmetrical</span>
<a name="line-818"></a><span class='hs-comment'>-- to 'Exp', so we get this nice type for 'run'.</span>
<a name="line-819"></a><span class='hs-comment'>--</span>
<a name="line-820"></a><span class='hs-comment'>-- &gt; run :: Handle -&gt; Exp a -&gt; IO (Res a)</span>
<a name="line-821"></a>
<a name="line-822"></a><a name="Res"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Res</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>Error</span> <span class='hs-layout'>(</span><span class='hs-conid'>Result</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-823"></a>
<a name="line-824"></a>
<a name="line-825"></a>
<a name="line-826"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-827"></a><span class='hs-comment'>-- | A value which can be converted from a 'Response'. All types which are</span>
<a name="line-828"></a><span class='hs-comment'>-- defined as being a 'Result a' should have a 'FromResponse a'. Because,</span>
<a name="line-829"></a><span class='hs-comment'>-- uhm.. you really want to be able to extract the result from the response.</span>
<a name="line-830"></a><span class='hs-comment'>--</span>
<a name="line-831"></a><span class='hs-comment'>-- There are two parsers defined here, one for atoms and the other for</span>
<a name="line-832"></a><span class='hs-comment'>-- sequences. These are the only two implementations of parseResponse which</span>
<a name="line-833"></a><span class='hs-comment'>-- should be used.</span>
<a name="line-834"></a>
<a name="line-835"></a><a name="Response"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>FromResponse</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-836"></a>    <span class='hs-varid'>parseResponse</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Response</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-varid'>a</span>
<a name="line-837"></a>
<a name="line-838"></a>
<a name="line-839"></a><a name="responseAtomParser"></a><span class='hs-definition'>responseAtomParser</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Response</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-varid'>a</span>
<a name="line-840"></a><span class='hs-definition'>responseAtomParser</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseType</span> <span class='hs-varid'>r</span><span class='hs-layout'>,</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseResult</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-841"></a>    <span class='hs-layout'>(</span><span class='hs-conid'>SuccessAtom</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>parseWire</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>parseDatum</span>
<a name="line-842"></a>    <span class='hs-keyword'>_</span>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fail</span> <span class='hs-varop'>$</span> <span class='hs-str'>"responseAtomParser: Not a single-element vector "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseResult</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-843"></a>
<a name="line-844"></a><a name="responseSequenceParser"></a><span class='hs-definition'>responseSequenceParser</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromDatum</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Response</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-layout'>(</span><span class='hs-conid'>Sequence</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-845"></a><span class='hs-definition'>responseSequenceParser</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>responseType</span> <span class='hs-varid'>r</span> <span class='hs-keyword'>of</span>
<a name="line-846"></a>    <span class='hs-conid'>SuccessAtom</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Done</span>    <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>responseAtomParser</span> <span class='hs-varid'>r</span>
<a name="line-847"></a>    <span class='hs-conid'>SuccessSequence</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Done</span>    <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>values</span>
<a name="line-848"></a>    <span class='hs-conid'>SuccessPartial</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Partial</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pure</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseToken</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>values</span>
<a name="line-849"></a>    <span class='hs-varid'>rt</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fail</span> <span class='hs-varop'>$</span> <span class='hs-str'>"responseSequenceParser: Unexpected type "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>rt</span>
<a name="line-850"></a>  <span class='hs-keyword'>where</span>
<a name="line-851"></a>    <span class='hs-varid'>values</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>V</span><span class='hs-varop'>.</span><span class='hs-varid'>mapM</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>parseWire</span> <span class='hs-varid'>x</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>parseDatum</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>responseResult</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span>
<a name="line-852"></a>
<a name="line-853"></a>
<a name="line-854"></a>
<a name="line-855"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-856"></a><span class='hs-comment'>-- | A token is used to refer to queries and the corresponding responses. This</span>
<a name="line-857"></a><span class='hs-comment'>-- driver uses a monotonically increasing counter.</span>
<a name="line-858"></a>
<a name="line-859"></a><a name="Token"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Token</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Word64</span>
<a name="line-860"></a>
<a name="line-861"></a>
<a name="line-862"></a>
<a name="line-863"></a><a name="ResponseType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ResponseType</span>
<a name="line-864"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SuccessAtom</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SuccessSequence</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SuccessPartial</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SuccessFeed</span>
<a name="line-865"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>WaitComplete</span>
<a name="line-866"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClientErrorType</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CompileErrorType</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuntimeErrorType</span>
<a name="line-867"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-868"></a>
<a name="line-869"></a>
<a name="line-870"></a><a name="instance%20FromJSON%20ResponseType"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>FromJSON</span> <span class='hs-conid'>ResponseType</span> <span class='hs-keyword'>where</span>
<a name="line-871"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span>  <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>SuccessAtom</span>
<a name="line-872"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span>  <span class='hs-num'>2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>SuccessSequence</span>
<a name="line-873"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span>  <span class='hs-num'>3</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>SuccessPartial</span>
<a name="line-874"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span>  <span class='hs-num'>4</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>WaitComplete</span>
<a name="line-875"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span>  <span class='hs-num'>5</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>SuccessFeed</span>
<a name="line-876"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span> <span class='hs-num'>16</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>ClientErrorType</span>
<a name="line-877"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span> <span class='hs-num'>17</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>CompileErrorType</span>
<a name="line-878"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Number</span> <span class='hs-num'>18</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>RuntimeErrorType</span>
<a name="line-879"></a>    <span class='hs-varid'>parseJSON</span> <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fail</span> <span class='hs-str'>"ResponseType"</span>
<a name="line-880"></a>
<a name="line-881"></a>
<a name="line-882"></a>
<a name="line-883"></a><a name="Response"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Response</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Response</span>
<a name="line-884"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>responseToken</span>     <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Token</span>
<a name="line-885"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>responseType</span>      <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>ResponseType</span>
<a name="line-886"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>responseResult</span>    <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-layout'>(</span><span class='hs-conid'>Vector</span> <span class='hs-conid'>Value</span><span class='hs-layout'>)</span>
<a name="line-887"></a>    <span class='hs-comment'>--, responseBacktrace :: ()</span>
<a name="line-888"></a>    <span class='hs-comment'>--, responseProfile   :: ()</span>
<a name="line-889"></a>    <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-890"></a>
<a name="line-891"></a>
<a name="line-892"></a>
<a name="line-893"></a><a name="responseParser"></a><span class='hs-definition'>responseParser</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Token</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Value</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Response</span>
<a name="line-894"></a><span class='hs-definition'>responseParser</span> <span class='hs-varid'>token</span> <span class='hs-layout'>(</span><span class='hs-conid'>A</span><span class='hs-varop'>.</span><span class='hs-conid'>Object</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-895"></a>    <span class='hs-conid'>Response</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pure</span> <span class='hs-varid'>token</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>o</span> <span class='hs-conid'>A</span><span class='hs-varop'>..:</span> <span class='hs-str'>"t"</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>o</span> <span class='hs-conid'>A</span><span class='hs-varop'>..:</span> <span class='hs-str'>"r"</span>
<a name="line-896"></a><span class='hs-definition'>responseParser</span> <span class='hs-keyword'>_</span>     <span class='hs-keyword'>_</span>          <span class='hs-keyglyph'>=</span>
<a name="line-897"></a>    <span class='hs-varid'>fail</span> <span class='hs-str'>"Response: Unexpected JSON value"</span>
<a name="line-898"></a>
<a name="line-899"></a>
<a name="line-900"></a>
<a name="line-901"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-902"></a><span class='hs-comment'>-- | Errors include a plain-text description which includes further details.</span>
<a name="line-903"></a><span class='hs-comment'>-- The RethinkDB protocol also includes a backtrace which we currently don't</span>
<a name="line-904"></a><span class='hs-comment'>-- parse.</span>
<a name="line-905"></a>
<a name="line-906"></a><a name="Error"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Error</span>
<a name="line-907"></a>
<a name="line-908"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ProtocolError</span> <span class='hs-varop'>!</span><span class='hs-conid'>Text</span>
<a name="line-909"></a>      <span class='hs-comment'>-- ^ An error on the protocol level. Perhaps the socket was closed</span>
<a name="line-910"></a>      <span class='hs-comment'>-- unexpectedly, or the server sent a message which the driver could not</span>
<a name="line-911"></a>      <span class='hs-comment'>-- parse.</span>
<a name="line-912"></a>
<a name="line-913"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ClientError</span> <span class='hs-varop'>!</span><span class='hs-conid'>Text</span>
<a name="line-914"></a>      <span class='hs-comment'>-- ^ Means the client is buggy. An example is if the client sends</span>
<a name="line-915"></a>      <span class='hs-comment'>-- a malformed protobuf, or tries to send [CONTINUE] for an unknown</span>
<a name="line-916"></a>      <span class='hs-comment'>-- token.</span>
<a name="line-917"></a>
<a name="line-918"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CompileError</span> <span class='hs-varop'>!</span><span class='hs-conid'>Text</span>
<a name="line-919"></a>      <span class='hs-comment'>-- ^ Means the query failed during parsing or type checking. For example,</span>
<a name="line-920"></a>      <span class='hs-comment'>-- if you pass too many arguments to a function.</span>
<a name="line-921"></a>
<a name="line-922"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RuntimeError</span> <span class='hs-varop'>!</span><span class='hs-conid'>Text</span>
<a name="line-923"></a>      <span class='hs-comment'>-- ^ Means the query failed at runtime. An example is if you add</span>
<a name="line-924"></a>      <span class='hs-comment'>-- together two values from a table, but they turn out at runtime to be</span>
<a name="line-925"></a>      <span class='hs-comment'>-- booleans rather than numbers.</span>
<a name="line-926"></a>
<a name="line-927"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
</pre></body>
</html>
